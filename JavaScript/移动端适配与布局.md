# 移动端适配与布局

## 1. 参考资料

1. [第三代移动端布局方案](https://segmentfault.com/a/1190000018850370)

2. [transform与position:fixed的那些恩怨](https://zhuanlan.zhihu.com/p/95021620)

3. [Rem布局的原理解析](https://zhuanlan.zhihu.com/p/30413803)

4. [移动端Web页面适配方案（整理版）](https://www.jianshu.com/p/2c33921d5a68)

5. [从网易与淘宝的font-size思考前端设计稿与工作流](https://www.cnblogs.com/lyzg/p/4877277.html)

6. [设备像素，CSS像素，设备独立像素](https://segmentfault.com/a/1190000015884091)

7. [移动端布局方案浅谈](https://segmentfault.com/a/1190000010412860)

8. [使用CSS3 REM 和 VW 打造等比例响应式页面的便捷工作流](https://zhuanlan.zhihu.com/p/23968868)

9. [HTML meta viewport属性说明(mark)](https://www.cnblogs.com/pigtail/archive/2013/03/15/2961631.html)

10. [移动前端开发之viewport,devicePixelRatio的深入理解](https://www.jianshu.com/p/413a25b2c503)

11. [【原创】移动端高清、多屏适配方案](http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041)

12. [纯 CSS 实现自适应正方形](https://segmentfault.com/a/1190000009476303)

## 1. 设备像素、CSS 像素和设备独立像素

### 1. 像素

1. 像素（Pel，pixel，pictureelement），为组成一幅图像的全部亮度和色度的最小图像单元。电视的图像是由按一定间隔排列的亮度不同的像点构成的，形成像点的单位也就是像素，组成图像的最小单位就是像素。从计算机技术的角度来解释，像素是硬件和软件所能控制的最小单位。它指显示屏的画面上表示出来的最小单位，不是图画上的最小单位。一幅图像通常包含成千上万个像素，每个像素都有自己的颜色信息，它们紧密地组合在一起。由于人眼的错觉，这些组合在一起的像素被当成一幅完整的图像。当修改图像的某区域，实际上是在修改该区域内的像素。对这些像素修改的好与坏将决定最终图片的质量。单位面积内的像素越多，图像的效果就越好。彩色电视图像是由成千个像素点所组成的，而且每个像素都是由红绿蓝三种颜色并排组成的。（注意每个像素的大小是不固定的，他是根据设备的分辨率决定的）

### 2. 设备像素

1. 设备像素，Device Pixel，简写为 DP，指的是设备屏幕的真实的像素数。

2. 设备像素又称**物理像素**，是设备能控制显示的最小单位，我们可以把它看做显示器上的一个点。我们常说的 1920x1080 像素分辨率就是用的设备像素单位。

### 3. css 像素

1. css像素是**web编程的概念**，它是**抽象的** ，实际上**不存在**。用于逻辑上衡量像素的单位。也就是我们做网页时用到的 css 像素单位。

2. css 像素是一个概念，并不是实际存在的。一个 css 像素在屏幕上如何显示，取决于屏幕和渲染方式。

### 4. 设备独立像素

1. 设备独立像素（Device Independent Pixel, DIP）也叫密度无关像素，可以认为是计算机坐标系统中的一个点，这个点表示一个可以由程序使用并控制的虚拟像素，可以由相关系统转换为物理像素（设备像素）。设备独立像素是一个整体概念，包括了css 像素，比如：css 像素，只是在 android 机中，css像素不叫 “css像素”，而叫“设备独立像素”。

### 5. 设备像素和设备独立像素的关系

1. 设备像素是设备的屏幕的实际像素数（屏幕上的一个点），而设备独立像素则是一个概念，可以认为其是计算机坐标系统中的一个点，这个点表示一个可以由程序使用并控制的虚拟像素，可以由相关系统转换为设备像素。那么二者之间的关系是怎样的呢，换句话说，一个设备独立像素对应几个设备像素呢？

2. 一般来说，设备像素和设备独立像素之间的关系，分为 PC 端和移动端，如下所示：
   - PC 端：1 个设备独立像素等于1个设备像素（在100% 未缩放的情况下），如果缩放到200%，则1个设备独立像素等于2个设备像素。
   - 移动端：根据设备不同，有很大差异。

### 6. PPI 和 DPR

1. PPI，是 Pixel Per Inch 的缩写，即每英寸像素数，计算公式如下：
   ![img.png](img/ppi.png)  

2. 上面的公式中，屏幕尺寸指的是屏幕的对角线的长度，单位是英寸。

3. 所谓的视网膜（Retina）屏幕，指的是 ppi 大于 300 的屏幕。这个概念是苹果在发布 iPhone 4 的时候提出的概念，乔布斯认为，ppi 大于 300 的时候，人眼已无法分辨屏幕上的像素。

4. 因为移动端设备差异比较大，而且随着屏幕技术发展和厂商竞争的加剧，应用 1080p、2160p 分辨率的屏幕的设备层出不穷，这些设备的 ppi 比较高，因此，设备像素与设备独立像素的关系也不一定是一一对应的关系。而 UE 在出设计稿的时候，不可能根据每个设备单独出一套，为了解决这个问题，引入了 DPR 这个概念。

5. 为什么我们需要获得设备像素与设备独立像素之间的比例关系呢，假设我们有一张图片，分辨率是 100 x 100，单位是 px，注意，这个单位不是设备像素，是类似于设备独立像素的一个单位。在设备 A 上面，设备像素和设备独立像素是1比1的关系，那么图片在屏幕上的实际尺寸是 100 × 100，正常显示。那么假设有一款设备 B，其设备分辨率是设备 A 的 2 倍，在尺寸不变的情况下，设备 B 的设备像素是设备 A 的一半。如果设备 B 的设备像素和设备独立像素的比例还是 1 比 1，那么同样的图片在设备 B 的屏幕上实际尺寸就是 50 × 50。看起来缩小了很多。这也就是同样的尺寸的内容，在分辨率越高的设备上显示的实际尺寸就越小（特别是 windows 系统的电脑）。

6. DPR，Device Pixel Ratio，设备像素比，指的是设备像素与设备独立像素的比值（横向或者纵向），计算公式如下：`DPR = 设备像素 / 设备独立像素`

7. DPR 描述了一个设备像素等于几个设备独立像素。（CSS 像素）。在浏览器中，可以通过 `window.devicePixelRatio` 获取到当前设备的 dpr。在 css 中，可以通过 `-webkit-device-pixel-ratio`，`webkit-min-device-pixel-ratio` 和 `-webkit-max-device-pixel-ratio` 进行媒体查询。

8. DPR 的最大意义就是，我们可以以某个设备的分辨率为标准来设计 UI 稿，对于不同的设备，我们只需要获得其设备的 DPR，那么根据设备的 DPR 对设计稿进行尺寸上的调整，这样就能在不同的设备上获得相同的体验。

9. 同样还是 100 × 100 的图片，如果设备 B 的 DPR 是 2，即两个设备像素对应一个设备独立像素，那么 图片在设备 B 的显示的实际尺寸还是 100 × 100。保持了内容尺寸的一致性。

10. 设备像素的大小是固定的，是不可变的。而设备独立像素是可以被拉长或压缩的。这个该怎么理解呢？看下图。
  ![img.png](img/dpr.png)

11. 看一个实际的例子，以 iPhone 6 为例，其设备宽高为 375 × 667，可以理解为设备独立像素，一般来说，设计稿也是这样的尺寸。iPhone 6 的 DPR 为 2，即一个设备独立像素对应两个设备像素。所以这个设计稿对应的设备的物理像素是 750 × 1334。如下图所示：
    ![img.png](img/dpr-2.png)

12. 从上图中可以看出，对于这样的css样式：
    ```css
       width: 2px;
       height: 2px;
    ```
    在不同的屏幕上(普通屏幕 / retina屏幕)，css 像素所呈现的大小(物理尺寸)是一致的，不同的是 1 个 css 像素所对应的物理像素个数是不一致的。
    - 在普通屏幕下，1 个 css 像素对应 1个物理像素（1:1）。 
    - 在 retina 屏幕下，DPR = 2，1 个 css 像素对应 4 个物理像素（1:4）。

## 2. rem、em、vh 和 vw

1. rem 是 CSS3 新增单位，是一个相对单位，相对的基础是根元素（一般是 html 元素）字体的大小。

2. em 也是一个相对单位，MDN 上对其的解释是：em 作为字体的单位时，其代表父元素的字体大小，em 作为其他属性单位时，代表自身字体大小。

3. vh 是 CSS3 新增的单位，其表示的是视口（页面的可视区域）高度的 1%。

4. vw 是 CSS3 新增的单位，其表示的是视口（页面的可视区域）宽度的 1%。

5. vmin 是 CSS3 新增的单位，视口高度 vw 和宽度 vh 两者之间的最小值。

6. vmax 是 CSS3 新增的单位，视口高度 vw 和宽度 vh 两者之间的最大值。

### 1. viewport

1. 视口(viewport)代表当前可见的计算机图形区域。在 Web 浏览器术语中，通常与浏览器窗口相同，但不包括浏览器的UI， 菜单栏等——即指你正在浏览的文档的那一部分。

2. 移动端配置视口的方式是在 html 中添加一个 meta 标签：
   `<meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1; minimum-scale=1; user-scalable=no;">
   `
3. meta 标签的每个属性的含义：
   
   属性|含义|取值
   :---:|:---:|:---:
    width|定义视口的宽度，单位为像素|正整数或者是设备宽度 device-width
    height|定义视口的高度，单位为像素|正整数或者是设备高度 device-height
    initial-scale|定义初始缩放值|整数或者小数
    minimum-scale|定义最小的缩放比例，必须小于或者等于 maximum-scale 设置的值|整数或者小数
    maximum-scale|定义的最大缩放比例，它必须大于或者等于 minimum-scale 设置的比例|整数或者小数
    user-scalable|定义是否允许用户手动缩放页面，默认是 yes|yes/no
    
4. 一般来说，移动端视口要想视觉效果和体验好，那么设置的视口宽度必去无限接近理想视口。

5. 理想视口：一般来讲，这个视口其实不是真是存在的，它对设备来说是一个最理想布局视口尺寸，在用户不进行手动缩放的情况下，可以将页面理想地展示。那么所谓的理想宽度就是浏览器（屏幕）的宽度了。于是上述的 meta 设置，就是我们的理想设置，他规定了我们的视口宽度为屏幕宽度，初始缩放比例为 1，就是初始时候我们的视觉视口就是理想视口。


## 3. 响应式布局

1. 响应式布局的概念：响应式布局指的是同一页面在不同屏幕尺寸下有不同的布局。传统的开发方式是PC端开发一套，手机端再开发一套，而使用响应式布局只要开发一套就够，使用 css 进行适配。响应式布局的缺点就是 css 比较重，需要针对不同的屏幕尺寸书写不同的样式。

2. 响应式设计与自适应设计的区别：
   - 响应式开发一套界面，通过检测视口分辨率，针对不同客户端在客户端做代码处理，来展现不同的布局和内容。
   - 自适应需要开发多套界面，通过检测视口分辨率，来判断当前访问的设备是 pc 端、平板、手机，从而请求服务层，返回不同的页面。

### 1. flex 布局

1. 严格来说。flex 布局是弹性布局，并不是响应式布局。

2. 


### 2. 百分比布局

1. 给元素的宽高设置为百分比单位，当浏览器的宽度或者高度发生变化时，通过百分比单位可以使得浏览器中的组件的宽和高随着浏览器的变化而变化，从而实现响应式的效果。

2. width、height 属性的百分比依托于父标签的宽高。就是说，子元素的 width 的百分比是相对于父元素的宽度，子元素的 height 的百分比是相对于父元素的高度。

3. padding、border、margin 等属性的情况又不一样，具体如下表所示：

   属性|百分比单位的含义
   :---:|:---:
   子元素的top和bottom|直接非static定位(默认定位)的父元素的高度
   子元素的left和right|相对于直接非static定位(默认定位的)父元素的宽度
   子元素的padding|不论是垂直方向或者是水平方向，都相对于直接父亲元素的 width，而与父元素的 height 无关
   子元素的margin|不论是垂直方向还是水平方向，都相对于直接父元素的width，与 height 无关
    border-radius|相对于自身的宽度

4. 使用百分比进行响应式布局的缺点：
   - 计算困难，如果我们要定义一个元素的宽度和高度，按照设计稿，必须换算成百分比单位。
   - 各个属性中如果使用百分比，相对父元素的属性并不是唯一的。比如 width 和 height 相对于父元素的 width 和 height，而 margin、padding 不管垂直还是水平方向都相对比父元素的宽度、border-radius 则是相对于元素自身等等，就是没有一个统一的作为比较基准的属性。这样就造成我们使用百分比单位容易使布局问题变得复杂。

5. 因此，不建议用百分比单位来做响应式布局。


### 3. 媒体查询

1. 使用`@media` 媒体查询可以针对不同的媒体类型定义不同的样式，特别是响应式页面，可以针对不同屏幕的大小，编写多套样式，从而达到自适应的效果。

2. 媒体查询的方式是使用纯 css 进行的响应式布局，示例代码如下：
   ```css
      @media screen and (max-width: 960px) {
          body {
            background-color:#FF6699
          }
      }

     @media screen and (max-width: 768px) {
         body {
             background-color:#00FF66;
         }
     }

     @media screen and (max-width: 550px) {
         body {
             background-color:#6633FF;
         }
     }

     @media screen and (max-width: 320px) {
          body {
              background-color:#FFFF00;
          }
      }

   ```
   通过媒体查询定义了几套 css 样式，通过 max-width 设置样式生效的最大分辨率。上面的媒体查询分别设置了分辨率在 0 ~ 320px、320px ~ 550px、550 px ~ 768px 以及 768px ~ 960px的屏幕设置了不同的背景颜色。

3. 通过媒体查询，可以通过给不同分辨率的设备编写不同的样式来实现响应式的布局，比如我们为不同分辨率的屏幕，设置不同的背景图片。比如给小屏幕手机设置@2x图，为大屏幕手机设置@3x图，通过媒体查询就能很方便的实现。

4. 不管是移动优先还是PC优先，都是依据当随着屏幕宽度增大或减小的时候，后面的样式会覆盖前面的样式。因此，移动端优先首先使用的是`min-width`，PC端优先使用的 `max-width`。

5. 媒体查询的缺点：
   - 浏览器大小改变时，需要改变的样式过多。
   - 分辨率的临界点不好确定。一般来说，是以 boostrap 的标准为依据的。
   - 如果再多一种屏幕尺寸，就得多写一个 @media 查询块，比较繁琐。

### 4. vh/vw

1. css3中引入了一个新的单位vw/vh，与视图窗口有关，vw表示相对于视图窗口的宽度，vh表示相对于视图窗口高度。 

2. 任意层级元素，在使用 vw 单位的情况下，1vw都等于视图宽度的百分之一。


### 5. rem

1. rem 是 css3 中新增加的单位，是一个相对单位，相对的是根元素（一般是 html 元素）字体的大小。 默认情况下，`html` 元素的 `font-size` 为 16px。所以此时 1rem = 16px。


## 4. 移动端布局方案

